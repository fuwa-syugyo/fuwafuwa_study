## Chapter 07

### SPA(Single Page Application)

ブラウザの画面遷移に起因する操作性や応答性の悪さを克服したWebアプリケーションの一形態。
単一のWebページ(HTML)で構成され、HTML全体の再読み込みを極力排除して表示を切り替えることができる。
HTMLの中身はほとんどからっぽで、JavaScriptを実行してレンダリングすることで内容を表示する。

### Ajax

「Asynchronous JavaScript + XML」の略。

### JavaScript

クライアントサイドJavaScriptと、サーバサイドJavaScriptが存在している。
前者はブラウザで動作し、HTMLを操作するAPIを利用できる。(SPAはこっち)
後者はサーバ上で動作し、コンピュータ上のファイルを直接読み書きできる。

#### DOM(Document Object Model)

ブラウザでHTMLファイルを読み込んだときに作られるツリー状のデータ構造。

documentオブジェクトを起点としてhtmlやbodyなどさまざまなElementを持ち、配下の要素を取得するためのメソッドがある。
例えば、
`getElementById()`メソッド: 指定したid属性を持つ要素を取得する
`querySelector()`メソッド: 指定されたCSSセレクタにマッチする最初の要素を取得する

Elementも同様に他要素を取得するためのメソッドやプロパティを持っている。
例えば、
`getAttributeNames()`メソッド: 要素が持つすべての属性名のリストを返す
`setAttribute()`メソッド: 指定された属性の値を追加or変更する
`parentElement`プロパティ: 親要素
`innerHTML`プロパティ: 要素内のHTML

#### イベントドリブンプログラミング

ユーザーの操作など、イベントが発生したときに実行すべき処理をそのイベントと紐づけて記述する。
その処理のことを`イベントハンドラ`または`イベントリスナ`と呼ぶ。

実際のところ、イベントドリブンプログラミングは逐次処理と同じようなものである。
イベントの発生をチェックするイベントループを、OSやフレームワークなどが肩代わりしているだけ。

#### フラグメント

HTML文書内の特定位置を表す印のこと。(見出しをクリックしたときにURLの末尾に入る#のことかな？)
SPAはそのままだと表示内容によってURLが変化しないのでブラウザバックができなかったりと不便である。そのためフラグメントを活用する。
ちなみにURLのフラグメント部はサーバに送信されないので、リクエストは発生しない。

JavaScriptでは`location`オブジェクトの`hash`プロパティを通してフラグメントを参照でき、`hashchange`イベントによってフラグメントを変化を知ることができる。

### SPAの課題

SPAの以前あった欠点として検索エンジンとの相性の悪さが挙げられる。

* URLのフラグメント部が検索エンジンのインデックス対象とならない
* JavaScriptを実行しないとページの内容がわからずインデックス対象にならない

加えて、JavaScriptを実行する必要がある等の理由で初期表示が遅いという問題もある。

#### History API

HTML5で登場したブラウザのAPI。
フラグメントでのページ表現について、擬似的にURLを変化させてSEOの問題を解決した。

リンクをクリックした際にブラウザでの遷移処理を止め、JavaScriptの`route()`関数に遷移先のパスを引数として渡して実行する。(route関数は本誌オリジナル？)
これによってDOM操作で表示内容を切り替える。

`route()`関数ではHistory APIが提供する`pushState()`メソッドを呼び出している。
これは、与えられたパスをブラウザのURLとして設定しつつURL表示履歴にも格納するというもの。
リクエストを発生させずにアドレスバーのURLを変化させることができる。

実際の開発だと画面遷移はルータというライブラリを使うことが多い。
ReactRouterとかVueRouterとか。

#### SSR(Server Side Rendering)

これまでのおさらい
`従来型アプリケーション`:
ブラウザからのGETリクエスト→サーバーサイドがテンプレートエンジンを使ってHTMLを生成して返す→ブラウザがそのHTMLを受け取って描画

`SPA`:
ブラウザがトップページのHTMLを読み込む→そのHTMLのscript要素に従い、ブラウザ上で実行するJavaScriptのファイルを要求し、実行→DOM APIを使って画面を構築しつつ、初期表示に必要な情報を非同期通信でサーバへ問い合わせる
`クライアントサイドレンダリング(CSR)`とも呼ばれている。

`SSR`:
初期のSPAでは画面構築をクライアントサイドに丸投げしていたが、初期表示に限ってはサーバーサイドで行うようにしたもの。
つまり、ブラウザからの最初のリクエスト時にサーバ側でHTMLを生成する。
これにより通信回数が減るため、初期表示が速くなる。加えてHTMLを返すため検索エンジンにも相性が良い。
クライアントサイドとサーバサイドが密に連携することになるため、Next.jsなどのフレームワークを使うと良いでしょう。
