## Web API

### Web APIとは

インターネットを経由したAPIの呼び出しのこと。
「HTTPによってネットワーク越しに呼び出せるようにしたAPI」。
Webにおけるサーバーサイドの役割が、
静的コンテンツの提供→動的コンテンツの提供→要求された処理の実行
というように変化していった結果、SPAにおけるHTTPリクエストはそのような位置付けになった。

そもそもAPI(Application Programming Interface)はコンピュータのプログラム同士がお互いにコミュニケーションを撮る際の取り決めのこと。
ここでいうインターフェースとは以下の3つの要素である。

* 呼び出すための「名前」
* 与えるべき「パラメータ(引数)」
* 得られる「結果(戻り値)」

これらが取り決められていればAPIを利用することができる。裏側がどうなっているのか知る必要はない。

### RPC(Remote procedure call: 遠隔手続き呼び出し)

分散システム上のコンピュータが互いの機能を呼び出すこと。
APIの延長として考えられてきた昔の技術。
遠隔呼び出しの仕様をIDL(インターフェース定義言語)というファイルに記述し、通信処理を行うプログラムを生成する。

### SOAP

Web技術ベースでRPCを実現する技術の1つとして作成されたもの。サーバへの処理要求や結果をXMLで表現し、それらをHTTPでやりとりする。
ちょっと昔に企業システムを通信に広まっていた。
企業システム目的のため複雑で導入のハードルが高かった。
RESTはシンプルでWebと相性が良かったため、あまり流行らなくなった。

### REST(Representational State Transfer: よく設計されたWebアプリケーションの動作イメージ)

Webの成功要素となったアーキテクチャの特徴のことで明確な仕様はない。
一応以下の要素がRESTで説明されているらしい。

* クライアントとサーバが分かれていること
* ステートレスであること
* キャッシュによって通信量が削減されていること
* インターフェースが統一されていること
* システム全体が階層化できること
* プログラムをダウンロードして実行できること

RESTのスコアが高いAPIを`RESTful API`と呼ぶ。

完全にRESTを守ることが最適解とは限らない。
リソースを重視しすぎてオーバー(/アンダー)フェッチングやN+1問題が発生してしまうなど、不便なことにもなりかねない。ケースバイケース。

#### リソース指向アーキテクチャ(ROA: Resource-Oriented Architecture)

RESTをAPIに当てはめて具現化したもの。
「リソース」は「さまざまな情報の集まり」。文書とか動画とかいろいろ。
リソースに対する操作を提供するAPIを示す。以下の4つの特性を持つ。

1. リソースの示し方(アドレス可能性)
* リソースを示すURLがあり、URLによってリソースにアクセスできる

2. リソースのたどり方(接続性)
* あるリソースから別のリソースをたどることができる

3. リソースの操作方法(統一インターフェース)
* リソースに対して何をしたいかは、HTTPメソッドで表現する
* リソース操作の結果は、HTTPステータスで表現する

4. リソース操作の手順(ステートレス性)
* リソース操作に手順は不要で、一度のやりとりで求められる結果が得られる

ざっくり言うと、「ティム・バーナーズ=リーが考えた当初のWebの思想をWeb上のAPIにも当てはめましょう」ということ。

### クロスオリジン通信

地震の取得元とは異なるドメインに対してリクエストを送信すること。
ブラウザによって危険と判断されることがある。
「同一オリジンポリシー」というものに反してしまうとAPIコールが失敗してしまう。
同じオリジンかどうかはURLのうち「スキーム」「ホスト」「ポート番号」が同じかどうかで識別される。

#### CORS(Cross-Origin Resource Sharing: オリジン間リソース共有)

同一オリジンポリシーによる制約を安全に緩和し、オリジン間のリクエストを許可するために作られた仕組み。

##### プリフライトリクエスト

ブラウザが相手サーバに対して事前にリクエストを送信して良いか確認するためのリクエスト。

特定の条件を満たせば省略される。(HTTPリクエストがGET, POST, HEADのどれかとか)
この条件を満たすリクエストのことは「シンプルリクエスト」と呼ばれることが多い。

### GraphQL

オーバー(/アンダー)フェッチング、N+1問題の解決策の一つとして注目されているクエリ言語。SQLポジション。
データ構造から必要なデータを抽出するための言語。
「どのような情報を取得したいか」を書き表す手段を提供する。

プログラミング言語一般で扱うオブジェクトを対象とし、スキーマに対する問い合わせパターン(クエリ)をあらかじめ定義しておく。
作成したクエリをGraphQLのエンドポイントへPOSTリクエストすれば、必要な情報だけを1回で取得できる。
(GETリクエストではないのはGETだとボディを送信できないため)

RESTよりもSOAPのようなRPCに近いものな感じ。RESTでニーズを満たせなかった部分を埋めている的な。相互補完。
