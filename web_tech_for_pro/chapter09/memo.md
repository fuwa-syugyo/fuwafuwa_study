## サーバプッシュ技術

従来型Webアプリケーションの欠点「サーバからの通知ができないこと」の解決について。

### サーバプッシュについて

HTTPがユーザからの要求を起点としてHTMLなどのコンテンツを返すような通信のことを`Pull型通信`と呼ぶのに対し、サーバ側を起点としてサーバ→クライアントへ情報を送信することを`サーバプッシュ`と呼ぶ。
当初のWWWでは静的コンテンツが中心だったので、情報が更新されてもページの読み直しで対応できていた。
が、Webアプリケーションの発展によって必要性が高まっていった。

* メタリフレッシュ: meta要素の記述に従って別のURLを再ロードさせる機能。
* ポーリング: 定期的にページのリロードを行うこと

**キャッシュ**

データを手元に保存しておき再利用することで効率化に繋げる仕組みのこと。
ブラウザにはサーバから取得したコンテンツをデバイス上に保存しておき、次に必要になったときにはHTTPリクエストを送信せずに保存したデータを再利用する仕組みがある。
例えばブラウザ上でページをリロードするとキャッシュが働いて通信量が削減され、ユーザーの体感速度が向上する。
ただしデータをずっと使い回しているとサーバ側の更新を反映することができない。有効期限を設けて、期限が切れてから必要になったときは改めてデータを取得する。

### Comet(ロングポーリング)

サーバがHTTPレスポンスの返し方を工夫することにより、HTTPの枠組みの中即時性を向上させる技術のこと。
通常、ブラウザがHTTPリクエストを送信するとサーバはすぐにレスポンスを返すのだが、Cometではサーバがレスポンスを保留し、通知すべき情報の変化が発生したときに初めてレスポンスを返す。
(ブラウザ上のJavaScriptはレスポンスを待ち続けていることになるが、Ajaxの非同期通信ならユーザーに影響はない)
ただし一度サーバから情報を送信すると再接続が必要。

### SSE(Server-sent events)について

「HTTPストリーミング」という考え方に基づいており、レスポンスを少しずつ返すことで一度のリクエストに対してサーバからの通知を連続して行うことができる。
HTTP/1.1で追加された`チャンク転送`という機能に基づいている。
チャンク転送はリクエストやレスポンスをいくつかの塊に分割して送信する機能のこと。
SSEではによるレスポンスヘッダのConnectionヘッダに`keep-alive`文字列を含めることにより、サーバがレスポンスを返した後に通信を持続させることを依頼している。

### WebSocket

双方向・高頻度・大量の通信を実現するために作られたプロトコル。
HTTPと比較して送受信に伴うオーバーヘッド(body以外の送受信。リクエストorレスポンスヘッダ、TCP接続処理など)が非常に少ない。
コンピュータ上で通信を始める際に、まずは`ハンドシェイク`と呼ばれる互いを確認するための一連のやり取りを行い、`プロトコルアップグレード`という仕組みを使って通信を始める。
なぜこんな回りくどいことをするのかというと昨今ではセキュリティの面で80(HTTP)と443(HTTPS)以外のポートは遮断されがちであるため、一旦HTTPとして通信を始めてこの問題を回避しているのである。
ただしWebSocketにも課題があり、SSEとも併用されているのが実情である。
例えば認証の仕組みを持っておらず、同一オリジンポリシーの制約もないためセキュリティに慎重な実装が求められる。
一般的なWebアプリケーションではHTTPによるWeb APIを中心としつつ、サーバプッシュが必要な場合にのみSSEかWebSocketを使い分けるのが良さげ。
