## Chapter 06

## セッション

クライアントとサーバーでのステートフルな一連の通信のこと。
HTTPは当初の設計思想によりステートレス(状態を持たない=リクエストの関係性がわからない)な通信である。
つまり、通信を識別することができない。
(ちなみにステータスフルな通信の例としてはFTPがある。)

そのためWebアプリケーションではセッションのように通信を識別する方法を別途作成する必要がある。

### クッキー

HTTPサーバがクライアントにレスポンスを返すときに付加する情報のこと。
クライアントはクッキーを保存し、次に同じサーバにリクエストを送信するとき、同じクッキーをリクエストに追加してサーバに送信する。

最も一般的な使い方はクライアントの識別。
サーバがクライアントからのリクエストを最初に受け取ったとき、クライアントを識別する情報を発行する。
その識別情報を参照して、どのクライアントからのリクエストなのか把握できる。
発行元と同じサーバにアクセスしたときに、クライアントはクッキーを送信する。

クッキーはクライアントにキーバリュー形式で保存されている。
保存方法は特に決まっておらず、発行元のサーバごとにクッキーを分けて保存している。
サーバがクライアントに情報を渡すときはHTTPレスポンスの`Set-Cookie`ヘッダに格納される。

### クッキーの属性

「発行元と同じサーバにアクセスしたときに、クライアントはクッキーを送信する」というのが基本的な考え方だが、細かな条件がある。
HTTPレスポンスの`Set-Cookie`ヘッダによってクッキーが渡されるが、ここに属性が付加される。
長いので詳細は省くが、概ね以下のように指定すると良いらしい。

* `Domain`属性
クッキーを受け取ったクライアントがどのサーバに対してアクセスしたときにクッキーを送信すべきか指定する。
基本的に未指定。クッキーを生成したドメインだけに送信されるようにする。

* `Path`属性
クッキーを受け取ったクライアントが、Domain属性で指定したサーバのどのパスに対してアクセスしたときにクッキーを送信すべきか指定する。
Domain属性は基本的に未指定なので、これも未指定？

* `Secure`属性
暗号化されたHTTPS通信のときだけクッキーを送信するように指定する。
これは指定しましょう。

* `HttpOnly`属性
未指定だとブラウザで保存しているクッキーはブラウザ上で動作するJavaScriptから読み書きできてしまうので、クロスサイトスクリプティングなどの危険性がある。
これは指定しましょう。

* `SameSite`属性
ブラウザからのクッキーの送信条件をより厳密に制限する。(詳細は難しいらしい)
可能な限り`Lax`or`Strict`を指定。クッキーを発行したドメインとは異なるオリジンのHTMLやJavaScriptからのリクエストにおいてクッキー送信を制限する。



