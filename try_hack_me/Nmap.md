## Nmap
### Nmapとは
様々な種類のポートスキャンを実行できる。
コンピュータには65,353個のポートがある。HTTPではほとんどの場合、サーバーのポートは80、HTTPS Webポートは443みたいな感じで決まっているものもあるが、そうとは限らない。
Nmapはターゲットの各ポートに順番に接続して、各ポートで実行されているサービスを列挙できる。

### TCPスキャン
3ウェイハンドシェイクのアレをスキャンするやつ。
SYN→SYN/ACK→ACKのやつ。

SYNフラグを設定したTCPリクエストを閉じたポートに送信すると、ターゲットサーバはRST(リセット)フラグが設定されたTCPパケットで応答する。
開いているポートにリクエストを送信した場合、ターゲットサーバはSYN/ACKフラグが設定されたTCPパケットで応答する。
ポートが開いているが、ファイアウォールで隠れている場合はドロップする。

### SYNスキャン
サーバーからSYN/ACKを受信した後、RST TCPパケットを送り返す。(つまりサーバが繰り返し要求しない)
SYN→SYN/ACK→RSTってコト。

TCPスキャンと比較して、ログに記録されないことがあるのが攻撃側のメリット。
Linuxで正しく動作させるのにsudo権限が必要。sudoでNmapを実行するときはSYNスキャンがデフォになる。

### UDPスキャン
UDP接続はハンドシェイクで接続を開始するのではなく、ターゲットポートにパケットを送信してパケットが到着することで接続してるっぽい。
UDPは確認応答がないのでスキャンが大変。
TCPスキャンとしてめちゃくちゃ遅い傾向がある。
`--top-ports <number>`みたいなオプションをつけるのおすすめ。

開いているUDPポートにパケットが送信された場合:
* 応答はない
* portが`open|filtered`ということになる(開いているが、ファイアウォールで保護されている)

UDP応答を受信した場合(レアケース):
* portがopenとしてマークされる
* 二重チェックとしてリクエストが2回送信される

閉じているUDPポートにパケットが送信された場合:
* portが到達不能であるというメッセージを含むICMPパケットで応答する
* 閉じられたportというマークをつけ、Nmapを続行

### ICMPネットワークスキャン
どのIPアドレスにアクティブなホストが含まれているか、含まれていないかを確認するためのスキャン。

### NSE(Nmap Script Engine)スクリプト
Nmapをめっちゃ強化してくれる機能。

### オプションとかのメモ
**-A**
アグレッシブモードにする。すなわちサービス検出、OSシステム検出、共通スクリプトスキャン等をアクティブにする時短スイッチらしい。スキャンの時間が増えるけどその分いろいろ調べてくれる感じ？

**-p-**
全てのポートをスキャン対象にする
