## 用語メモ
### プロセス
- プログラムの実行単位

### ジョブ
- コンピューター上で実行されるタスクや処理のこと
- シェルが管理している、「シェルを実行する作業単位」のこと
- Railsアプリケーションに対して並列で実行される
- 複数のコマンドを集めたもの、すなわちプロセスの集まり

#### QUEUEジョブ
- キューを指定して実行するやつ

#### PCジョブ、UNIXジョブ、アクションジョブ、カスタムジョブ
- 実行するエージェントホストを指定して実行するやつ

### キューとは
- 実行登録されたジョブを一時保管するところ
- 先に登録されたものを先に実行する

#### キューイング
- キューに登録されたジョブの状態のこと

### エージェントとは
- ジョブを実行するホスト
- キューに複数のエージェントを接続する場合はエージェントの優先順位を指定できる

ジョブはキューに登録され、順番に並べられる
キューに接続されているエージェントに対して順次転送され、実行される

## ActiveJobメモ
### 使用場面
バックグラウンドで実行したいもの。つまりリアルタイム性がないものや重たい処理。
ex:
- メールの送信
- 画像の処理
- データ集計

### キューを登録する
こんな感じ。`perform_later()`で登録する。`set`はオプション。
```
# 明日正午に実行したいジョブをキューに登録する
GuestsCleanupJob.set(wait_until: Date.tomorrow.noon).perform_later(guest)
```

### キューイングバックエンド
- デフォのRailsだと、ジョブをメモリに保持するインプロセスのキューイングシステムしか提供してくれないので、ジョブのキュー登録と実行でキューイングのバックエンドが必要
- - つまり、ActiveJobだけだとプロセスが切れるとジョブが失われる。非同期バックエンドが必要。
- `[config.active_job.queue_adapter = :sidekiq]`みたいな感じで設定できる

#### キューイングバックエンドのライブラリ
- sucker_punch
- - 非同期処理をスレッドで実行するため、Railsとプロセスを分けなくておｋ
- - ジョブ実行中にRails再起動すると、実行中のジョブは強制的に中断され、再起動後のリトライも自動では実行されない

- Sidekiq
- - マルチスレッド
- - 別プロセスを立てる
- - Railsプロセスが終了してもリトライ可能
- - ジョブを永続化するためにRedisなどが必要

- Resque
- - シングルスレッド
- - Redisが必要
- - メモリを消費するが、肥大化の心配はないらしい

- Delayed Job
- - シングルスレッド
- - Redis不要ですぐRailsに導入できる

などなど。超ざっくりまとめ

### コールバック
Active Jobが提供するフックを用いて、ジョブのライフサイクル中にロジックをトリガできる。
メソッドとして実装すればいいらしい。


